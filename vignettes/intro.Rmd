---
title: "Introduction to the `RankingProject` package"
author: "Jerzy Wieczorek"
date: "`r Sys.Date()`"
output: rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{Introduction to the `RankingProject` package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette introduces the `RankingProject` package, which accompanies "A Primer on Visualizations for Comparing Populations, Including the Issue of Overlapping Confidence Intervals" (Wright, Klein, and Wieczorek, 2017).

The package provides functions for plotting ranked tables of data side-by-side with their plots. The available plots include grids, confidence intervals, and related visualizations designed for making one-to-many or many-to-many comparisons.

TODO: Add figure/table options to use LaTeX vs plain labels.

```{r, fig.width=6.5, fig.height=8}
library(RankingProject)

USfile  <- system.file("extdata", "USA.csv",
                       package = "RankingProject")
USdata  <- read.csv(USfile, header=TRUE, stringsAsFactors=FALSE)
USdata  <- subset(USdata, Abbreviation != "USA")
refAbbr <- "CO"
refRow  <- which(USdata$Abbreviation==refAbbr)
refRank <- USdata$Rank[refRow]
refName <- USdata$State[refRow]
refEst  <- USdata$Estimate.2dec[refRow]

tableParList <- list(Rank = USdata$Rank, PlaceName = USdata$State, 
                     Est = formatC(USdata$Estimate.2dec,
                                   format = 'f', digits = 2),
                     SE = substring(formatC(round(USdata$SE.2dec, 2),
                                            format = 'f', digits = 2), 2),
                     PlaceType = "State")

figureParList <- list(est = USdata$Estimate.2dec, se = USdata$SE.2dec,
                      names = USdata$Abbreviation, 
                      refName = refAbbr,
                      confLevel = .9)

annotParList <- list(refRank = refRank, refFullName = refName)

# Pantyhose plot
figureParList$plotType <- "columns"
tableParList$pantyhoseRefLine <- .7
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  tablewidthProp = 2/7)
tableParList$pantyhoseRefLine <- NULL

# Individual CIs
figureParList$plotType <- "individual"
figureParList$cex <- 0.6
# figureParList$legendText <- ""  # can remove auto-legend this way
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)
# figureParList$legendText <- NULL

# CIs for differences from ref
figureParList$lwdBold <- 5
figureParList$plotType <- "difference"
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  annotParList = annotParList)

# Comparison intervals
figureParList$plotType <- "comparison"
figureParList$thetaLine <- 1.5
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)
figureParList$thetaLine <- NULL
figureParList$lwdBold <- NULL

# Goldstein-Healy adjusted CIs
figureParList$plotType <- "individual"
figureParList$GH <- TRUE
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)

# Double-tiered GH plot:
# inner tiers are GH CIs,
# outer tiers are usual 90% CIs
figureParList$tiers <- 2
# Legend auto-positioning is poor with line breaks in legend text;
# we can improve it by controlling (X,Y) manually
figureParList$legendX <- 12
figureParList$legendY <- 53
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)

# Double-tiered GH + Bonferroni plot:
# inner tiers are usual 90% CIs,
# outer tiers are 50-way demi-Bonferroni-corrected GH CIs
figureParList$Bonferroni <- "demi"
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)
```


