---
title: "Introduction to the `RankingProject` package"
author: "Jerzy Wieczorek"
date: "`r Sys.Date()`"
output: rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{Introduction to the `RankingProject` package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette introduces the `RankingProject` package, which accompanies "A Primer on Visualizations for Comparing Populations, Including the Issue of Overlapping Confidence Intervals" (Wright, Klein, and Wieczorek, 2017).

The package provides functions for plotting ranked tables of data side-by-side with their plots. The available plots include grids, confidence intervals, and related visualizations designed for making one-to-many or many-to-many comparisons.



```{r, fig.width=6.5, fig.height=8}
library(RankingProject)

USfile <- system.file("extdata", "USA.csv",
                      package = "RankingProject")
USdata <- read.csv(USfile, header=TRUE, stringsAsFactors=FALSE)
USdata <- subset(USdata, Abbreviation != "USA")
refAbbr <- "CO"
refRow <- which(USdata$Abbreviation==refAbbr)
refRank <- USdata$Rank[refRow]
refName <- USdata$State[refRow]
refEst <- USdata$Estimate.2dec[refRow]


# All but one of the plots

tableParList <- list(Rank = USdata$Rank, PlaceName = USdata$State, 
  Est = formatC(USdata$Estimate.2dec, format = 'f', digits = 2),
  SE = substring(formatC(round(USdata$SE.2dec, 2), format = 'f', digits = 2), 2),
  PlaceType = "State")

figureParList <- list(est = USdata$Estimate.2dec, se = USdata$SE.2dec,
  names = USdata$Abbreviation, refEst = refEst, ref = refAbbr, refName = refName,
  cex = 0.6, lwdBold = 5)

annotParList <- list(refRank = refRank, refFullName = refName)


RankPlotWithTable(file = NULL, figwidth = NULL, figheight = NULL,
  tableParList = tableParList, figureParList = figureParList,
  annotParList = annotParList, figureFunction = SIMPLE.rankCompPlot)


RankPlotWithTable(file = tempfile('RegularCIs.US', fileext = 'tex'),
  figwidth = 6.5, figheight = 8,
  tableParList = tableParList, figureParList = figureParList,
  annotParList = NULL, figureFunction = REG.CIs.rankCompPlot)

RankPlotWithTable(file = tempfile('AlmondExample.US.bold', fileext = 'tex'),
  figwidth = 6.5, figheight = 8,
  tableParList = tableParList, figureParList = figureParList,
  annotParList = NULL, figureFunction = ALMOND.rankCompPlot)

figureParList$conf.level <- ConfidenceLevelGH(figureParList$se)
RankPlotWithTable(file = tempfile('GoldsteinHealy.US', fileext = 'tex'),
  figwidth = 6.5, figheight = 8,
  tableParList = tableParList, figureParList = figureParList,
  annotParList = NULL, figureFunction = REG.CIs.rankCompPlot)

figureParList$conf.level <- .9
annotParList$tablewidthProp <- 2/7
figureParList$refRank <- refRank
tableParList$pantyhoseRefLine <- .7
RankPlotWithTable(file = tempfile('Pantyhose.US', fileext = 'tex'),
  figwidth = 6.5, figheight = 8,
  tableParList = tableParList, figureParList = figureParList,
  annotParList = NULL, figureFunction = PANTYHOSE.rankCompPlot)


# Double-tiered GH plot

tableParList <- list(Rank = USdata$Rank, PlaceName = USdata$State, 
                     Est = formatC(USdata$Estimate.2dec, format = 'f', digits = 2),
                     SE = substring(formatC(round(USdata$SE.2dec, 2), format = 'f', digits = 2), 2),
                     PlaceType = "State")
figureParList <- list(est = USdata$Estimate.2dec, se = USdata$SE.2dec,
                      names = USdata$Abbreviation, refEst = refEst, ref = refAbbr, refName = refName,
                      cex = 0.6, lwdBold = 5)
annotParList <- list(refRank = refRank, refFullName = refName)


# Adjusting and plotting two-tiered version of Goldstein-Healy:
# inner tier is usual 90% CIs,
# outer tier is 50-way Bonf-corrected GH plot
figureParList$conf.level <- .9
figureParList$conf.level.2 <- ConfidenceLevelGH(figureParList$se)
outfile <- tempfile('DoubleGoldsteinHealy.US.50Bonf', fileext = 'tex')
RankPlotWithTable(file = outfile,
                      figwidth = 6.5, figheight = 8,
                      tableParList = tableParList, figureParList = figureParList,
                      annotParList = NULL, figureFunction = double.REG.CIs.rankCompPlot)
```


