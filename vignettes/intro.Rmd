---
title: "Introduction to the `RankingProject` package"
author: "Jerzy Wieczorek"
date: "`r Sys.Date()`"
output: rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{Introduction to the `RankingProject` package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette introduces the `RankingProject` package, which accompanies "A Primer on Visualizations for Comparing Populations, Including the Issue of Overlapping Confidence Intervals" (Wright, Klein, and Wieczorek, 2017).

The package provides functions for plotting ranked tables of data side-by-side with their plots. The available plots include grids, confidence intervals, and related visualizations designed for making one-to-many or many-to-many comparisons.

TODO: Add figure/table options to use LaTeX vs plain labels.

```{r, fig.width=6.5, fig.height=8}
library(RankingProject)

USfile  <- system.file("extdata", "USA.csv",
                       package = "RankingProject")
USdata  <- read.csv(USfile, header=TRUE, stringsAsFactors=FALSE)
USdata  <- subset(USdata, Abbreviation != "USA")
refAbbr <- "CO"
refRow  <- which(USdata$Abbreviation==refAbbr)
refRank <- USdata$Rank[refRow]
refName <- USdata$State[refRow]
refEst  <- USdata$Estimate.2dec[refRow]

tableParList <- list(Rank = USdata$Rank, PlaceName = USdata$State, 
                     Est = formatC(USdata$Estimate.2dec,
                                   format = 'f', digits = 2),
                     SE = substring(formatC(round(USdata$SE.2dec, 2),
                                            format = 'f', digits = 2), 2),
                     PlaceType = "State")

figureParList <- list(est = USdata$Estimate.2dec, se = USdata$SE.2dec,
                      names = USdata$Abbreviation, 
                      ref = refAbbr,
                      cex = 0.6, conf.level = .9)

annotParList <- list(refRank = refRank, refFullName = refName)

# Pantyhose plot
figureParList$refRank <- refRank
tableParList$pantyhoseRefLine <- .7
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  annotParList = NULL, figureFunction = PANTYHOSE.rankCompPlot,
                  tablewidthProp = 2/7)
figureParList$refRank <- NULL
tableParList$pantyhoseRefLine <- NULL

# Individual CIs
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  annotParList = NULL, figureFunction = REG.CIs.rankCompPlot)

# CIs for differences from ref
figureParList$lwdBold = 5
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  annotParList = annotParList,
                  figureFunction = SIMPLE.rankCompPlot)

# Comparison intervals
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  annotParList = NULL, figureFunction = ALMOND.rankCompPlot)
figureParList$lwdBold = NULL

# Goldstein-Healy adjusted CIs
figureParList$conf.level <- ConfidenceLevelGH(figureParList$se)
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  annotParList = NULL, figureFunction = REG.CIs.rankCompPlot)

# Double-tiered GH plot:
# inner tiers are usual 90% CIs,
# outer tiers are 50-way demi-Bonferroni-corrected GH CIs
figureParList$conf.level <- .9
figureParList$conf.level.2 <- ConfidenceLevelGH(figureParList$se)
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  annotParList = NULL,
                  figureFunction = double.REG.CIs.rankCompPlot)
```


