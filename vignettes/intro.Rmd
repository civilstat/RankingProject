---
title: "Introduction to the `RankingProject` package"
author: "Jerzy Wieczorek"
date: "`r Sys.Date()`"
output: rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{Introduction to the `RankingProject` package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette introduces the `RankingProject` package, which accompanies "A Primer on Visualizations for Comparing Populations, Including the Issue of Overlapping Confidence Intervals" (Wright, Klein, and Wieczorek, 2017).

The package provides functions for plotting ranked tables of data side-by-side with their plots. The available plots include grids, confidence intervals, and related visualizations designed for making one-to-many or many-to-many comparisons.

```{r, fig.width=6.5, fig.height=8}
library(RankingProject)

# TODO: drop USA row (or add an example using it as reference "state"?);
# resave in .Rdata format; add a documentation file for the dataset too
USfile  <- system.file("extdata", "USA.csv",
                       package = "RankingProject")
USdata  <- read.csv(USfile, header=TRUE, stringsAsFactors=FALSE)
USdata  <- subset(USdata, Abbreviation != "USA")
head(USdata)

# Format estimates and SEs into strings with 2 digits past the decimal
USdata$Estimate.Print = formatC(USdata$Estimate.2dec,
                                format = 'f', digits = 2)
# For SEs, also drop the leading 0
USdata$SE.Print = substring(formatC(USdata$SE.2dec,
                                    format = 'f', digits = 2),
                            first = 2)

# Set Colorado as the reference state
refAbbr <- "CO"
refRow  <- which(USdata$Abbreviation==refAbbr)

# Set up parameter lists for table function, figure function, and annotations
tableParList <- with(USdata,
                     list(ranks = Rank, names = State, 
                          est = Estimate.Print, se = SE.Print,
                          placeType = "State"))

figureParList <- with(USdata,
                      list(est = Estimate.2dec, se = SE.2dec,
                           names = Abbreviation, refName = refAbbr,
                           confLevel = .9))

annotParList <- with(USdata,
                     list(refRank = Rank[refRow],
                          refFullName = State[refRow]))

# Pantyhose plot
figureParList$plotType <- "columns"
tableParList$pantyhoseRefLine <- .7
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  tablewidthProp = 2/7)
tableParList$pantyhoseRefLine <- NULL

# Individual CIs
figureParList$plotType <- "individual"
figureParList$cex <- 0.6
# figureParList$legendText <- ""  # can remove auto-legend this way
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)
# figureParList$legendText <- NULL

# CIs for differences from ref
figureParList$lwdBold <- 5
figureParList$plotType <- "difference"
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList,
                  annotParList = annotParList)

# Comparison intervals
figureParList$plotType <- "comparison"
figureParList$thetaLine <- 1.5
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)
figureParList$thetaLine <- NULL
figureParList$lwdBold <- NULL

# Goldstein-Healy adjusted CIs
figureParList$plotType <- "individual"
figureParList$GH <- TRUE
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)

# Double-tiered GH plot:
# inner tiers are GH CIs,
# outer tiers are usual 90% CIs
figureParList$tiers <- 2
# Legend auto-positioning is poor with line breaks in legend text;
# we can improve it by controlling (X,Y) manually
figureParList$legendX <- 12
figureParList$legendY <- 53
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)

# Double-tiered GH + Bonferroni plot:
# inner tiers are usual 90% CIs,
# outer tiers are 50-way demi-Bonferroni-corrected GH CIs
figureParList$Bonferroni <- "demi"
RankPlotWithTable(tableParList = tableParList, figureParList = figureParList)
```


